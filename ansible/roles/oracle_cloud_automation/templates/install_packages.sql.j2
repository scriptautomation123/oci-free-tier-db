-- Generated by Ansible - Oracle Package Installation Script
-- Timestamp: {{ ansible_date_time.iso8601 }}
-- Environment: {{ deployment_environment | default('development') }}
-- Database: {{ database_name }}

WHENEVER SQLERROR EXIT SQL.SQLCODE
WHENEVER OSERROR EXIT FAILURE
SET SERVEROUTPUT ON SIZE UNLIMITED
SET VERIFY OFF
SET ECHO ON

PROMPT ====================================================================
PROMPT Oracle Partition Management Suite Installation
PROMPT Database: {{ database_name }}
PROMPT Timestamp: {{ timestamp }}
PROMPT ====================================================================

-- Connect as ADMIN
CONNECT {{ infrastructure.admin_username.value }}/{{ infrastructure.admin_password.value }}@{{ infrastructure.database_name.value }}_HIGH

PROMPT Installing Oracle partition management packages...

-- Load the installation suite
@{{ install_suite_path }}

PROMPT ====================================================================
PROMPT Installation Summary
PROMPT ====================================================================

-- Check installation results
SELECT 
    object_name,
    object_type,
    status,
    TO_CHAR(created, 'YYYY-MM-DD HH24:MI:SS') as created_date
FROM user_objects 
WHERE object_type IN ('PACKAGE', 'PACKAGE BODY')
AND created > SYSDATE - 1/24  -- Last hour
ORDER BY object_type, object_name;

-- Check for any compilation errors
SELECT 
    name,
    type,
    line,
    position,
    text as error_message
FROM user_errors
WHERE type IN ('PACKAGE', 'PACKAGE BODY')
ORDER BY name, type, line;

PROMPT ====================================================================
PROMPT Installation completed at {{ ansible_date_time.iso8601 }}
PROMPT ====================================================================

EXIT;