# Oracle Database Suite - Enhanced Connection Guide
# Generated: {{ deployment_time }}
# Environment: {{ deployment_environment | default('development') }}
# Always Free Tier Deployment

## 💰 COST INFORMATION
🎯 Tier: Always Free
💵 Monthly Cost: $0.00
⏰ Time Limit: None (permanent)
🔒 Cost Protection: Enabled (lifecycle rules prevent charges)

## 🗄️ DATABASE INFORMATION
📛 Name: {{ database_info.database_name.value }}
🔢 Version: {{ database_info.database_version.value }}
⚡ Specs: 1 OCPU, 20GB storage (Always Free tier limits)
🆔 Database ID: {{ database_info.database_id.value }}
🌍 Region: {{ database_info.region.value | default('us-ashburn-1') }}

## 🌐 WEB INTERFACES
🖥️  Service Console: {{ database_info.service_console_url.value }}
{% for name, url in database_info.connection_urls.value.items() %}
📊 {{ name | title | replace('_', ' ') }}: {{ url }}
{% endfor %}

## 🔐 AUTHENTICATION & CREDENTIALS

### Admin Account
👤 Username: {{ database_info.admin_username.value }}
🔑 Password: {{ database_info.admin_password.value }}
🎭 Role: ADMIN (Full database access)

### Schema-Based Access
👥 Schema User: {{ schema_user | default('PARTMGMT') }}
🔐 Schema Password: {{ schema_password | default(database_info.admin_password.value) }}
📁 Default Schema: {{ schema_user | default('PARTMGMT') }}
🎯 Purpose: Application-specific operations

## 🔗 CONNECTION STRINGS & SERVICES
{% for service, connection in database_info.connection_strings.value.items() %}
🔌 {{ service | upper }}: {{ connection }}
{% endfor %}

## 🚀 ENHANCED CONNECTION OPTIONS

### Quick Connect Scripts
```bash
# Interactive connection (recommended)
./enhanced-connect-db.sh

# Direct admin connection
./enhanced-connect-db.sh admin

# Schema user connection
./enhanced-connect-db.sh schema

# Read-only connection
./enhanced-connect-db.sh readonly

# Custom schema connection
DB_SCHEMA_USER=MYUSER ./enhanced-connect-db.sh schema
```

### Manual Connection Commands
```bash
# Admin connection
sqlplus {{ database_info.admin_username.value }}/{{ database_info.admin_password.value }}@{{ database_info.database_name.value }}_HIGH

# Schema connection (if configured)
sqlplus {{ schema_user | default('PARTMGMT') }}/{{ schema_password | default(database_info.admin_password.value) }}@{{ database_info.database_name.value }}_HIGH

# With TNS Admin explicitly set
export TNS_ADMIN="{{ wallet_dir }}"
sqlplus {{ database_info.admin_username.value }}/{{ database_info.admin_password.value }}@{{ database_info.database_name.value }}_HIGH
```

## 📊 SCHEMA MANAGEMENT OPERATIONS

### Available Deployment Actions
🔄 **deploy**: Full schema deployment (drop + create + packages + data)
🗑️  **reset-schema**: Drop and recreate schema structure only
📊 **reset-data**: Reset data while preserving schema
🧪 **test-only**: Run validation tests without changes

### Schema Management Commands
```bash
# Deploy complete schema
ansible-playbook playbooks/local-complete.yml -e deployment_action=deploy

# Reset schema structure
ansible-playbook playbooks/local-complete.yml -e deployment_action=reset-schema

# Reset data only
ansible-playbook playbooks/local-complete.yml -e deployment_action=reset-data

# Run tests only
ansible-playbook playbooks/local-complete.yml -e deployment_action=test-only
```

### GitHub Actions Workflows
```bash
# Trigger schema deployment via GitHub Actions
gh workflow run deploy-oracle-packages.yml -f deployment_action=deploy

# Trigger data reset
gh workflow run deploy-oracle-packages.yml -f deployment_action=reset-data
```

## 📦 DEPLOYED COMPONENTS STATUS

### Infrastructure
✅ Oracle Autonomous Database (Always Free)
✅ Wallet-based authentication configured
✅ Network security configured
✅ Cost protection lifecycle rules enabled

### Database Schema
{% if deployment_action is defined and deployment_action in ['deploy', 'reset-schema'] %}
✅ Schema: {{ schema_user | default('PARTMGMT') }}
✅ Partition Management Packages
✅ Configuration Tables
✅ Validation Framework
{% else %}
⏳ Schema deployment pending (use deployment_action=deploy)
{% endif %}

### Sample Data
{% if deployment_action is defined and deployment_action in ['deploy', 'reset-data'] %}
✅ Test datasets loaded
✅ Performance benchmarks available
✅ Example data for validation
{% else %}
⏳ Sample data loading pending
{% endif %}

## 🛠️ DEVELOPMENT WORKFLOW

### Schema Development Cycle
1. **Deploy**: `ansible-playbook playbooks/local-complete.yml -e deployment_action=deploy`
2. **Develop**: Make schema changes in SQL files
3. **Test**: `ansible-playbook playbooks/local-complete.yml -e deployment_action=test-only`
4. **Reset**: `ansible-playbook playbooks/local-complete.yml -e deployment_action=reset-schema`
5. **Repeat**: Iterative development

### Connection Pattern Examples
```sql
-- Check current user and schema
SELECT USER, SYS_CONTEXT('USERENV', 'CURRENT_SCHEMA') FROM dual;

-- List available schemas
SELECT username FROM all_users 
WHERE username NOT LIKE '%$%' 
ORDER BY username;

-- Switch schema context (if privileges allow)
ALTER SESSION SET CURRENT_SCHEMA = {{ schema_user | default('PARTMGMT') }};

-- Verify schema objects
SELECT object_type, COUNT(*) 
FROM user_objects 
GROUP BY object_type 
ORDER BY object_type;
```

## 🧪 TESTING & VALIDATION

### Available Test Scripts
```bash
# Run all validation tests
./run-examples.sh

# Performance benchmarks
./run-benchmarks.sh

# Generate validation report
ansible-playbook playbooks/test-and-validate-only.yml
```

### Manual Validation Queries
```sql
-- Verify partition management setup
SELECT table_name, partitioning_type, partition_count 
FROM user_part_tables;

-- Check package status
SELECT object_name, status 
FROM user_objects 
WHERE object_type = 'PACKAGE';

-- Validate data integrity
SELECT table_name, num_rows 
FROM user_tables 
WHERE table_name LIKE 'TEST_%';
```

## 📚 ALWAYS FREE TIER BENEFITS & LIMITS

### ✅ Benefits
- 🆓 No time limits or expiration
- 💰 No charges ever (with proper configuration)
- 🔧 Full Oracle Database functionality
- 🚀 Enterprise-grade features included
- 📊 Advanced analytics and ML capabilities

### ⚠️  Limits & Restrictions
- 🖥️  1 OCPU maximum (enforced by lifecycle rules)
- 💾 20GB storage maximum (enforced by lifecycle rules)
- 🏢 Up to 2 Autonomous Databases per tenancy
- 🌐 No auto-scaling (disabled for cost protection)
- 🔄 Manual scaling not allowed (lifecycle prevented)

### 🛡️  Cost Protection Measures
- 🚨 Terraform lifecycle rules prevent scaling
- 🔒 Variable validation enforces limits
- ✅ Ansible assertions verify compliance
- 📊 Monitoring alerts on configuration drift

## ♻️  CLEANUP & MANAGEMENT

### Resource Cleanup
```bash
# Complete cleanup (removes all resources)
ansible-playbook playbooks/cleanup-resources.yml

# Schema-only cleanup
ansible-playbook playbooks/local-complete.yml -e deployment_action=reset-schema
```

### Backup & Recovery
```bash
# Export schema data
sqlplus {{ database_info.admin_username.value }}/{{ database_info.admin_password.value }}@{{ database_info.database_name.value }}_HIGH @export_data.sql

# Monitor database usage
SELECT * FROM user_segments ORDER BY bytes DESC;
```

## 🆘 TROUBLESHOOTING

### Common Connection Issues
1. **Wallet not found**: Verify `{{ wallet_dir }}` exists and contains wallet files
2. **TNS error**: Check `TNS_ADMIN` environment variable points to wallet directory
3. **Authentication failure**: Verify credentials in connection details above
4. **Service not available**: Ensure database is running in OCI console

### Schema Issues
1. **Schema doesn't exist**: Run deployment with `deployment_action=deploy`
2. **Permission denied**: Use admin connection to grant privileges
3. **Objects missing**: Verify deployment completed successfully

### Performance Issues
1. **Slow queries**: Remember this is Always Free tier (limited resources)
2. **Connection timeouts**: Check network connectivity and OCI service status
3. **Space issues**: Monitor 20GB storage limit compliance

## 📞 SUPPORT & RESOURCES

- 📖 Oracle Documentation: https://docs.oracle.com/en/cloud/paas/autonomous-database/
- 🎓 Oracle Learning: https://education.oracle.com/
- 💬 Community Forums: https://community.oracle.com/
- 🔧 OCI Support (for paid accounts): https://support.oracle.com/

---
*This connection guide is automatically generated and updated with each deployment.*
*Last updated: {{ deployment_time }}*